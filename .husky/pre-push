#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Skip pre-push hook if --no-verify is used
if [ "$SKIP_PRE_PUSH" = "true" ]; then
  exit 0
fi

echo "ğŸ” Running pre-push checks..."

# Run TypeScript type checking
echo "ğŸ“ Checking TypeScript types..."
npx tsc --noEmit || {
  echo "âŒ TypeScript check failed. Please fix type errors before pushing."
  echo "ğŸ’¡ Tip: Run 'npx tsc --noEmit' locally to see all type errors."
  exit 1
}

# Run linting on staged files
echo "ğŸ§¹ Running linters..."
npx lint-staged || {
  echo "âŒ Linting failed. Please fix linting errors before pushing."
  echo "ğŸ’¡ Tip: Run 'npm run lint:fix' to fix linting issues."
  exit 1
}

# Run basic tests
echo "ğŸ§ª Running basic tests..."
npm test || {
  echo "âŒ Tests failed. Please fix failing tests before pushing."
  echo "ğŸ’¡ Tip: Run 'npm test' locally to see test failures."
  exit 1
}

echo "âœ… All pre-push checks passed!" 